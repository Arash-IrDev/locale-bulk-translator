# ترجمه چانک‌های بزرگ (Chunked Translation)

## مقدمه

برای فایل‌های ترجمه بسیار بزرگ (با بیش از 20000 کلید)، سیستم ترجمه چانک‌های بزرگ طراحی شده است که امکان کنترل دقیق‌تر و بررسی مرحله به مرحله ترجمه را فراهم می‌کند.

## ویژگی‌های کلیدی

### 1. تقسیم خودکار به چانک‌ها
- فایل‌های بزرگ به چانک‌های کوچک‌تر تقسیم می‌شوند
- هر چانک شامل 50 کلید (قابل تنظیم) است
- پردازش چانک‌ها به صورت متوالی انجام می‌شود

### 2. نمایش diff ناحیه‌ای
- برای هر چانک، diff جداگانه نمایش داده می‌شود
- امکان بررسی دقیق تغییرات قبل از اعمال
- نمایش محتوای اصلی و ترجمه شده در کنار هم

### 3. کنترل‌های تعاملی
- **✅ Accept This Chunk**: پذیرش چانک فعلی
- **❌ Reject This Chunk**: رد کردن چانک فعلی
- **⏸️ Pause Translation**: توقف موقت فرایند
- **🛑 Cancel All**: لغو کامل فرایند

### 4. Progress Tracking
- نمایش پیشرفت کلی فرایند
- شمارش چانک‌های پردازش شده
- نمایش تعداد توکن‌های مصرف شده

## نحوه استفاده

### 1. دستور ترجمه فایل بزرگ
```bash
# از طریق Command Palette
i18n Nexus: Translate Large File (Chunked)
```

### 2. دستور لغو ترجمه
```bash
# از طریق Command Palette
i18n Nexus: Cancel Translation
```

### 3. تنظیمات قابل تغییر

در `settings.json`:
```json
{
  "i18nNexus.chunkSize": 50,
  "i18nNexus.enableChunkedTranslation": true
}
```

## روند کار

### مرحله 1: آماده‌سازی
1. تشخیص فایل فعال در editor
2. خواندن فایل‌های پایه و هدف
3. تشخیص تغییرات مورد نیاز ترجمه
4. تقسیم به چانک‌ها

### مرحله 2: پردازش چانک‌ها
برای هر چانک:
1. ترجمه محتوا با LLM
2. نمایش diff ناحیه‌ای
3. دریافت تصمیم کاربر
4. ذخیره نتیجه (در صورت پذیرش)

### مرحله 3: نهایی‌سازی
1. ادغام همه چانک‌های پذیرفته شده
2. نمایش diff نهایی
3. اعمال تغییرات (در صورت تایید)

## مزایا

### 1. کنترل بهتر
- امکان بررسی هر بخش جداگانه
- جلوگیری از اعمال تغییرات ناخواسته
- امکان توقف و ادامه فرایند

### 2. مدیریت حافظه
- پردازش بخش‌های کوچک‌تر
- کاهش مصرف حافظه
- جلوگیری از timeout

### 3. تجربه کاربری بهتر
- نمایش پیشرفت واضح
- امکان تصمیم‌گیری آگاهانه
- کنترل کامل بر فرایند

## نکات مهم

### 1. اندازه چانک
- چانک‌های کوچک‌تر = کنترل بیشتر + سرعت کمتر
- چانک‌های بزرگ‌تر = سرعت بیشتر + کنترل کمتر
- پیشنهاد: 50 کلید برای شروع

### 2. مدیریت خطا
- در صورت خطا در یک چانک، فرایند ادامه می‌یابد
- خطاها در log ثبت می‌شوند
- امکان retry برای چانک‌های مشکل‌دار

### 3. فایل‌های موقت
- فایل‌های diff موقت ایجاد می‌شوند
- به صورت خودکار پاک می‌شوند
- در صورت crash، فایل‌ها باقی می‌مانند

## مثال استفاده

```typescript
// فایل با 20000 کلید
{
  "key1": "Hello World",
  "key2": "Welcome",
  // ... 19998 کلید دیگر
  "key20000": "Goodbye"
}

// تقسیم به 400 چانک (هر چانک 50 کلید)
// پردازش متوالی با بررسی هر چانک
```

## تنظیمات پیشرفته

### 1. تغییر اندازه چانک
```json
{
  "i18nNexus.chunkSize": 25  // چانک‌های کوچک‌تر
}
```

### 2. غیرفعال کردن
```json
{
  "i18nNexus.enableChunkedTranslation": false
}
```

## عیب‌یابی

### مشکل: فرایند متوقف می‌شود
- بررسی اتصال اینترنت
- بررسی اعتبار API key
- بررسی محدودیت‌های rate limit

### مشکل: فایل‌های موقت باقی می‌مانند
- اجرای دستور cleanup
- پاک کردن دستی پوشه temp

### مشکل: diff نمایش داده نمی‌شود
- بررسی مجوزهای فایل
- بررسی فضای دیسک
- restart VS Code 