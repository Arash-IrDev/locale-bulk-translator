# Progressive Diff Fix - نمایش تجمعی تغییرات

## مشکل اصلی

در diff view، فقط تغییرات چانک فعلی نمایش داده می‌شد، نه کل تغییرات ترجمه شده تا آن لحظه. این باعث می‌شد که:

1. **چانک اول**: تغییرات نمایش داده می‌شد
2. **چانک‌های بعدی**: diff view خالی به نظر می‌رسید
3. **عدم نمایش تجمعی**: کاربر نمی‌توانست پیشرفت کلی ترجمه را ببیند

## راه‌حل پیاده‌سازی شده

### تغییر در `showDiffViewWithControls`

**قبل:**
```typescript
// فقط تغییرات چانک فعلی اعمال می‌شد
const newContent = JSON.parse(JSON.stringify(originalContent));
for (const key in translatedChanges) {
    this.setNestedProperty(newContent, key, translatedChanges[key]);
}
```

**بعد:**
```typescript
// استفاده از فایل موقت که شامل تمام تغییرات ترجمه شده است
let tempContent: any = {};
if (fs.existsSync(this.tempFilePath)) {
    tempContent = this.loadJsonFile(this.tempFilePath);
}
fs.writeFileSync(tempDiffPath, JSON.stringify(tempContent, null, 2));
```

### منطق جدید

1. **فایل موقت**: تمام تغییرات ترجمه شده در فایل موقت ذخیره می‌شود
2. **Diff View**: diff بین فایل اصلی و فایل موقت نمایش داده می‌شود
3. **تجمعی**: هر چانک جدید به فایل موقت اضافه می‌شود
4. **نمایش کامل**: کاربر کل پیشرفت ترجمه را می‌بیند

## نحوه کارکرد

### مرحله 1: چانک اول
```
فایل اصلی: { "title": "Add permission for" }
فایل موقت: { "title": "افزودن دسترسی برای" }
Diff: نمایش تغییر "Add permission for" → "افزودن دسترسی برای"
```

### مرحله 2: چانک دوم
```
فایل اصلی: { "title": "Add permission for", "label": "Add a permission" }
فایل موقت: { "title": "افزودن دسترسی برای", "label": "افزودن یک دسترسی" }
Diff: نمایش هر دو تغییر
```

### مرحله 3: چانک سوم
```
فایل اصلی: { "title": "Add permission for", "label": "Add a permission", "name": "User information" }
فایل موقت: { "title": "افزودن دسترسی برای", "label": "افزودن یک دسترسی", "name": "اطلاعات کاربر" }
Diff: نمایش هر سه تغییر
```

## مزایا

1. **نمایش تجمعی**: کاربر کل پیشرفت ترجمه را می‌بیند
2. **شفافیت**: مشخص است که کدام بخش‌ها ترجمه شده‌اند
3. **کنترل کیفیت**: امکان بررسی ترجمه‌های قبلی
4. **تجربه کاربری بهتر**: احساس پیشرفت و تکمیل کار
5. **Debugging آسان‌تر**: امکان تشخیص مشکلات در مراحل مختلف

## مثال عملی

**چانک 1 ترجمه شده:**
```json
{
  "access-control": {
    "add-permission": {
      "title": "افزودن دسترسی برای",      // ✅ ترجمه شده
      "role-label": "نقش"                  // ✅ ترجمه شده
    },
    "permissions": {
      "title": "Permissions",              // ❌ هنوز ترجمه نشده
      "add-label": "Add a permission"      // ❌ هنوز ترجمه نشده
    }
  }
}
```

**چانک 2 ترجمه شده:**
```json
{
  "access-control": {
    "add-permission": {
      "title": "افزودن دسترسی برای",      // ✅ ترجمه شده
      "role-label": "نقش"                  // ✅ ترجمه شده
    },
    "permissions": {
      "title": "دسترسی‌ها",                // ✅ ترجمه شده
      "add-label": "افزودن یک دسترسی"      // ✅ ترجمه شده
    }
  }
}
```

**Diff View**: هر دو تغییر (چانک 1 و 2) نمایش داده می‌شوند

## تست

تغییرات با شبیه‌سازی فرآیند ترجمه تدریجی تست شده‌اند:

- **چانک 1**: 2 تغییر اعمال شد
- **چانک 2**: 2 تغییر اضافی اعمال شد  
- **چانک 3**: 2 تغییر اضافی اعمال شد
- **نتیجه نهایی**: 6 تغییر در کل

تست نشان می‌دهد که:
- هر چانک تغییرات خود را به فایل موقت اضافه می‌کند
- diff view تغییرات تجمعی را نمایش می‌دهد
- تمام ترجمه‌ها در نتیجه نهایی حفظ می‌شوند

## نتیجه

حالا diff view به درستی کار می‌کند و:
- تغییرات تجمعی نمایش داده می‌شوند
- کاربر پیشرفت کلی ترجمه را می‌بیند
- هر چانک جدید به تغییرات قبلی اضافه می‌شود
- تجربه کاربری بهتری ارائه می‌دهد 